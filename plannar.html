<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DailyDish - Meal Planner</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      position: relative;
      background: #fafafa;
      border-bottom: 1px solid #ddd;
    }

    .logo {
      width: 50px;
      height: auto;
    }

    .title {
      font-size: 24px;
      font-weight: bold;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    .header-buttons {
      display: flex;
      gap: 10px;
    }

    .home-btn {
      padding: 8px 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none;
    }

    .home-btn:hover {
      background-color: #45a049;
    }

    .planner-container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .day-header {
      text-align: center;
      font-weight: bold;
      padding: 10px;
      background-color: #f0f0f0;
      border-radius: 4px;
    }

    .day {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      min-height: 120px;
      background-color: white;
      cursor: pointer;
      transition: all 0.2s;
    }

    .day:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .day-number {
      font-weight: bold;
      margin-bottom: 5px;
      text-align: right;
    }

    .meal-item {
      padding: 4px 8px;
      margin: 4px 0;
      border-radius: 4px;
      font-size: 12px;
    }

    .breakfast { background-color: #fff9c4; }
    .lunch { background-color: #c8e6c9; }
    .dinner { background-color: #bbdefb; }
    .snacks { background-color: #f8bbd0; }
    .dessert { background-color: #d1c4e9; }

    .meal-form {
      margin-top: 20px;
      padding: 20px;
      background-color: #f9f9f9;
      border-radius: 8px;
    }

    .meal-form h3 {
      margin-top: 0;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .form-group select, 
    .form-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .form-buttons {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-primary {
      background-color: #4CAF50;
      color: white;
    }

    .btn-primary:hover {
      background-color: #45a049;
    }

    .btn-secondary {
      background-color: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover {
      background-color: #e0e0e0;
    }

    .current-month {
      text-align: center;
      margin: 20px 0;
      font-size: 20px;
      font-weight: bold;
    }

    .month-navigation {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .nav-btn {
      padding: 8px 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .nav-btn:hover {
      background-color: #45a049;
    }

    .week-at-glance {
      margin-top: 30px;
      padding: 20px;
      background-color: #f0f4f8;
      border-radius: 8px;
    }

    .week-at-glance h2 {
      margin-top: 0;
      color: #333;
    }

    .week-days {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding-bottom: 10px;
    }

    .week-day {
      min-width: 200px;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      background-color: white;
    }

    .week-day h4 {
      margin: 0 0 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid #eee;
    }

    .empty-day {
      color: #999;
      font-style: italic;
      font-size: 14px;
    }

    .remove-meal {
      float: right;
      color: #f44336;
      cursor: pointer;
      font-size: 10px;
    }
  </style>
</head>
<body>
  <header class="header">
    <img
      src="https://cdn.vectorstock.com/i/500p/89/68/abstract-logo-of-a-cafe-or-restaurant-spoon-vector-17248968.jpg"
      alt="Logo"
      class="logo"
    />
    <h1 class="title">DailyDish Planner</h1>
    <div class="header-buttons">
      <a href="home.html" class="home-btn">Home</a>
    </div>
  </header>

  <div class="planner-container">
    <div class="month-navigation">
      <button id="prevMonth" class="nav-btn">Previous Month</button>
      <h2 id="currentMonth" class="current-month">Month Year</h2>
      <button id="nextMonth" class="nav-btn">Next Month</button>
    </div>

    <div class="calendar" id="calendar">
      <!-- Calendar will be generated by JavaScript -->
    </div>

    <div class="meal-form" id="mealForm" style="display: none;">
      <h3>Plan Meals for <span id="selectedDate"></span></h3>
      <div class="form-group">
        <label for="mealType">Meal Type:</label>
        <select id="mealType">
          <option value="breakfast">Breakfast</option>
          <option value="lunch">Lunch</option>
          <option value="dinner">Dinner</option>
          <option value="snacks">Snacks</option>
          <option value="dessert">Dessert</option>
        </select>
      </div>
      <div class="form-group">
        <label for="mealName">Select Meal:</label>
        <select id="mealName">
          <!-- Options will be populated by JavaScript -->
        </select>
      </div>
      <div class="form-buttons">
        <button id="saveMeal" class="btn btn-primary">Save</button>
        <button id="cancelMeal" class="btn btn-secondary">Cancel</button>
      </div>
    </div>

    <div class="week-at-glance">
      <h2>This Week at a Glance</h2>
      <div class="week-days" id="weekView">
        <!-- Week view will be generated by JavaScript -->
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Get current date
      let currentDate = new Date();
      let currentYear = currentDate.getFullYear();
      let currentMonth = currentDate.getMonth();

      // DOM elements
      const calendarEl = document.getElementById('calendar');
      const currentMonthEl = document.getElementById('currentMonth');
      const prevMonthBtn = document.getElementById('prevMonth');
      const nextMonthBtn = document.getElementById('nextMonth');
      const mealFormEl = document.getElementById('mealForm');
      const selectedDateEl = document.getElementById('selectedDate');
      const saveMealBtn = document.getElementById('saveMeal');
      const cancelMealBtn = document.getElementById('cancelMeal');
      const mealTypeEl = document.getElementById('mealType');
      const mealNameEl = document.getElementById('mealName');
      const weekViewEl = document.getElementById('weekView');

      // Load saved meals from DailyDish page
      let savedMeals = {};
      try {
        savedMeals = JSON.parse(localStorage.getItem('savedMeals')) || {
          breakfast: [],
          lunch: [],
          dinner: [],
          snacks: [],
          dessert: []
        };
        
        // If savedMeals exists but doesn't have all meal types, initialize them
        if (!savedMeals.breakfast) savedMeals.breakfast = [];
        if (!savedMeals.lunch) savedMeals.lunch = [];
        if (!savedMeals.dinner) savedMeals.dinner = [];
        if (!savedMeals.snacks) savedMeals.snacks = [];
        if (!savedMeals.dessert) savedMeals.dessert = [];
      } catch (e) {
        console.error("Error loading saved meals:", e);
        savedMeals = {
          breakfast: [],
          lunch: [],
          dinner: [],
          snacks: [],
          dessert: []
        };
      }

      // Store planned meals
      let plannedMeals = JSON.parse(localStorage.getItem('plannedMeals')) || {};

      // Initialize calendar
      renderCalendar(currentYear, currentMonth);
      renderWeekView();

      // Event listeners
      prevMonthBtn.addEventListener('click', () => {
        currentMonth--;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        renderCalendar(currentYear, currentMonth);
      });

      nextMonthBtn.addEventListener('click', () => {
        currentMonth++;
        if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        renderCalendar(currentYear, currentMonth);
      });

      cancelMealBtn.addEventListener('click', () => {
        mealFormEl.style.display = 'none';
      });

      // When meal type changes, update meal options
      mealTypeEl.addEventListener('change', function() {
        updateMealOptions(this.value);
      });

      saveMealBtn.addEventListener('click', () => {
        if (!selectedDate) return;
        
        const mealType = mealTypeEl.value;
        const mealName = mealNameEl.value;
        
        if (!mealName) return;
        
        const dateKey = formatDateKey(selectedDate);
        
        if (!plannedMeals[dateKey]) {
          plannedMeals[dateKey] = [];
        }
        
        // Check if this meal type already exists for this date
        const existingIndex = plannedMeals[dateKey].findIndex(meal => meal.type === mealType);
        
        if (existingIndex >= 0) {
          // Replace existing meal of this type
          plannedMeals[dateKey][existingIndex] = {
            type: mealType,
            name: mealName
          };
        } else {
          // Add new meal
          plannedMeals[dateKey].push({
            type: mealType,
            name: mealName
          });
        }
        
        localStorage.setItem('plannedMeals', JSON.stringify(plannedMeals));
        renderCalendar(currentYear, currentMonth);
        renderWeekView();
        mealFormEl.style.display = 'none';
      });

      // Update meal options based on selected type
      function updateMealOptions(mealType) {
        mealNameEl.innerHTML = '';
        
        // Add default option
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = '-- Select a meal --';
        mealNameEl.appendChild(defaultOption);
        
        // Add saved meals for this type
        if (savedMeals[mealType] && savedMeals[mealType].length > 0) {
          savedMeals[mealType].forEach(meal => {
            const option = document.createElement('option');
            option.value = meal.name;
            option.textContent = meal.name;
            mealNameEl.appendChild(option);
          });
        } else {
          const noMealsOption = document.createElement('option');
          noMealsOption.value = '';
          noMealsOption.textContent = 'No saved meals for this type';
          mealNameEl.appendChild(noMealsOption);
        }
      }

      // Render calendar function
      function renderCalendar(year, month) {
        // Update month header
        const monthNames = ["January", "February", "March", "April", "May", "June",
          "July", "August", "September", "October", "November", "December"];
        currentMonthEl.textContent = `${monthNames[month]} ${year}`;
        
        // Get first and last day of month
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        
        // Get days in month
        const daysInMonth = lastDay.getDate();
        
        // Get starting day of week (0-6)
        const startDay = firstDay.getDay();
        
        // Clear calendar
        calendarEl.innerHTML = '';
        
        // Add day headers
        const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        dayNames.forEach(day => {
          const dayHeader = document.createElement('div');
          dayHeader.className = 'day-header';
          dayHeader.textContent = day;
          calendarEl.appendChild(dayHeader);
        });
        
        // Add empty cells for days before the first day of month
        for (let i = 0; i < startDay; i++) {
          const emptyDay = document.createElement('div');
          emptyDay.className = 'day empty';
          calendarEl.appendChild(emptyDay);
        }
        
        // Add days of month
        for (let day = 1; day <= daysInMonth; day++) {
          const date = new Date(year, month, day);
          const dateKey = formatDateKey(date);
          const dayEl = document.createElement('div');
          dayEl.className = 'day';
          
          // Add day number
          const dayNumber = document.createElement('div');
          dayNumber.className = 'day-number';
          dayNumber.textContent = day;
          dayEl.appendChild(dayNumber);
          
          // Add meals if any
          if (plannedMeals[dateKey] && plannedMeals[dateKey].length > 0) {
            plannedMeals[dateKey].forEach(meal => {
              const mealEl = document.createElement('div');
              mealEl.className = `meal-item ${meal.type}`;
              mealEl.innerHTML = `
                ${meal.name}
                <span class="remove-meal" data-date="${dateKey}" data-type="${meal.type}">✕</span>
              `;
              dayEl.appendChild(mealEl);
            });
          }
          
          // Add click event
          dayEl.addEventListener('click', (e) => {
            // Don't open form if clicking on remove button
            if (e.target.classList.contains('remove-meal')) return;
            
            selectedDate = date;
            selectedDateEl.textContent = `${monthNames[month]} ${day}, ${year}`;
            mealFormEl.style.display = 'block';
            
            // Set default meal type and update options
            mealTypeEl.value = 'breakfast';
            updateMealOptions('breakfast');
          });
          
          // Highlight current day
          const today = new Date();
          if (date.getDate() === today.getDate() && 
              date.getMonth() === today.getMonth() && 
              date.getFullYear() === today.getFullYear()) {
            dayEl.style.border = '2px solid #4CAF50';
          }
          
          calendarEl.appendChild(dayEl);
        }
        
        // Add event listeners to remove buttons
        document.querySelectorAll('.remove-meal').forEach(btn => {
          btn.addEventListener('click', function() {
            const dateKey = this.getAttribute('data-date');
            const mealType = this.getAttribute('data-type');
            
            if (plannedMeals[dateKey]) {
              plannedMeals[dateKey] = plannedMeals[dateKey].filter(meal => meal.type !== mealType);
              
              if (plannedMeals[dateKey].length === 0) {
                delete plannedMeals[dateKey];
              }
              
              localStorage.setItem('plannedMeals', JSON.stringify(plannedMeals));
              renderCalendar(year, month);
              renderWeekView();
            }
          });
        });
      }
      
      // Render week view
      function renderWeekView() {
        weekViewEl.innerHTML = '';
        
        const today = new Date();
        const currentDay = today.getDay(); // 0 (Sun) to 6 (Sat)
        const startOfWeek = new Date(today);
        startOfWeek.setDate(today.getDate() - currentDay);
        
        for (let i = 0; i < 7; i++) {
          const day = new Date(startOfWeek);
          day.setDate(startOfWeek.getDate() + i);
          const dateKey = formatDateKey(day);
          
          const dayEl = document.createElement('div');
          dayEl.className = 'week-day';
          
          const dayName = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][i];
          const dayNumber = day.getDate();
          const monthName = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"][day.getMonth()];
          
          dayEl.innerHTML = `<h4>${dayName}<br>${monthName} ${dayNumber}</h4>`;
          
          if (plannedMeals[dateKey] && plannedMeals[dateKey].length > 0) {
            plannedMeals[dateKey].forEach(meal => {
              const mealEl = document.createElement('div');
              mealEl.className = `meal-item ${meal.type}`;
              mealEl.innerHTML = `
                <strong>${meal.type.charAt(0).toUpperCase() + meal.type.slice(1)}:</strong> ${meal.name}
                <span class="remove-meal" data-date="${dateKey}" data-type="${meal.type}">✕</span>
              `;
              dayEl.appendChild(mealEl);
            });
          } else {
            const emptyEl = document.createElement('div');
            emptyEl.className = 'empty-day';
            emptyEl.textContent = 'No meals planned';
            dayEl.appendChild(emptyEl);
          }
          
          weekViewEl.appendChild(dayEl);
        }
      }
      
      // Helper function to format date as key
      function formatDateKey(date) {
        return `${date.getFullYear()}-${date.getMonth()}-${date.getDate()}`;
      }
    });
  </script>
</body>
</html>
