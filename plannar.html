<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DailyDish - Meal Planner</title>
  
  <!-- PyScript Requirements -->
  <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
  <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  
  <style>
 body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      position: relative;
      background: #fafafa;
      border-bottom: 1px solid #ddd;
    }

    .logo {
      width: 50px;
      height: auto;
    }

    .title {
      font-size: 24px;
      font-weight: bold;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    .header-buttons {
      display: flex;
      gap: 10px;
    }

    .home-btn {
      padding: 8px 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none;
    }

    .home-btn:hover {
      background-color: #45a049;
    }

    .planner-container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .day-header {
      text-align: center;
      font-weight: bold;
      padding: 10px;
      background-color: #f0f0f0;
      border-radius: 4px;
    }

    .day {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      min-height: 120px;
      background-color: white;
      cursor: pointer;
      transition: all 0.2s;
    }

    .day:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .day-number {
      font-weight: bold;
      margin-bottom: 5px;
      text-align: right;
    }

    .meal-item {
      padding: 4px 8px;
      margin: 4px 0;
      border-radius: 4px;
      font-size: 12px;
    }

    .breakfast { background-color: #fff9c4; }
    .lunch { background-color: #c8e6c9; }
    .dinner { background-color: #bbdefb; }
    .snacks { background-color: #f8bbd0; }
    .dessert { background-color: #d1c4e9; }

    .meal-form {
      margin-top: 20px;
      padding: 20px;
      background-color: #f9f9f9;
      border-radius: 8px;
    }

    .meal-form h3 {
      margin-top: 0;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .form-group select, 
    .form-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .form-buttons {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-primary {
      background-color: #4CAF50;
      color: white;
    }

    .btn-primary:hover {
      background-color: #45a049;
    }

    .btn-secondary {
      background-color: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover {
      background-color: #e0e0e0;
    }

    .current-month {
      text-align: center;
      margin: 20px 0;
      font-size: 20px;
      font-weight: bold;
    }

    .month-navigation {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .nav-btn {
      padding: 8px 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .nav-btn:hover {
      background-color: #45a049;
    }

    .week-at-glance {
      margin-top: 30px;
      padding: 20px;
      background-color: #f0f4f8;
      border-radius: 8px;
    }

    .week-at-glance h2 {
      margin-top: 0;
      color: #333;
    }

    .week-days {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding-bottom: 10px;
    }

    .week-day {
      min-width: 200px;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      background-color: white;
    }

    .week-day h4 {
      margin: 0 0 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid #eee;
    }

    .empty-day {
      color: #999;
      font-style: italic;
      font-size: 14px;
    }

    .remove-meal {
      float: right;
      color: #f44336;
      cursor: pointer;
      font-size: 10px;
    }
  </style>
</head>
<body>
    <header class="header">
        <img
          src="https://cdn.vectorstock.com/i/500p/89/68/abstract-logo-of-a-cafe-or-restaurant-spoon-vector-17248968.jpg"
          alt="Logo"
          class="logo"
        />
        <h1 class="title">DailyDish Planner</h1>
        <div class="header-buttons">
          <a href="home.html" class="home-btn">Home</a>
        </div>
      </header>
    
      <div class="planner-container">
        <div class="month-navigation">
          <button id="prevMonth" class="nav-btn">Previous Month</button>
          <h2 id="currentMonth" class="current-month">Month Year</h2>
          <button id="nextMonth" class="nav-btn">Next Month</button>
        </div>
    
        <div class="calendar" id="calendar">
          <!-- Calendar will be generated by JavaScript -->
        </div>
    
        <div class="meal-form" id="mealForm" style="display: none;">
          <h3>Plan Meals for <span id="selectedDate"></span></h3>
          <div class="form-group">
            <label for="mealType">Meal Type:</label>
            <select id="mealType">
              <option value="breakfast">Breakfast</option>
              <option value="lunch">Lunch</option>
              <option value="dinner">Dinner</option>
              <option value="snacks">Snacks</option>
              <option value="dessert">Dessert</option>
            </select>
          </div>
          <div class="form-group">
            <label for="mealName">Select Meal:</label>
            <select id="mealName">
              <!-- Options will be populated by JavaScript -->
            </select>
          </div>
          <div class="form-buttons">
            <button id="saveMeal" class="btn btn-primary">Save</button>
            <button id="cancelMeal" class="btn btn-secondary">Cancel</button>
          </div>
        </div>
    
        <div class="week-at-glance">
          <h2>This Week at a Glance</h2>
          <div class="week-days" id="weekView">
            <!-- Week view will be generated by JavaScript -->
          </div>
        </div>
      </div>

  <py-script>
from js import document, localStorage, Date
from pyodide import create_proxy

def run():
    # Get current date
    currentDate = Date.new()
    currentYear = currentDate.getFullYear()
    currentMonth = currentDate.getMonth()

    # DOM elements
    calendarEl = document.getElementById('calendar')
    currentMonthEl = document.getElementById('currentMonth')
    prevMonthBtn = document.getElementById('prevMonth')
    nextMonthBtn = document.getElementById('nextMonth')
    mealFormEl = document.getElementById('mealForm')
    selectedDateEl = document.getElementById('selectedDate')
    saveMealBtn = document.getElementById('saveMeal')
    cancelMealBtn = document.getElementById('cancelMeal')
    mealTypeEl = document.getElementById('mealType')
    mealNameEl = document.getElementById('mealName')
    weekViewEl = document.getElementById('weekView')

    # Load saved meals from DailyDish page
    savedMeals = {}
    try:
        savedMeals = JSON.parse(localStorage.getItem('savedMeals')) or {
            'breakfast': [],
            'lunch': [],
            'dinner': [],
            'snacks': [],
            'dessert': []
        }
        
        # If savedMeals exists but doesn't have all meal types, initialize them
        if not savedMeals.get('breakfast'): savedMeals['breakfast'] = []
        if not savedMeals.get('lunch'): savedMeals['lunch'] = []
        if not savedMeals.get('dinner'): savedMeals['dinner'] = []
        if not savedMeals.get('snacks'): savedMeals['snacks'] = []
        if not savedMeals.get('dessert'): savedMeals['dessert'] = []
    except Exception as e:
        print(f"Error loading saved meals: {e}")
        savedMeals = {
            'breakfast': [],
            'lunch': [],
            'dinner': [],
            'snacks': [],
            'dessert': []
        }

    # Store planned meals
    plannedMeals = JSON.parse(localStorage.getItem('plannedMeals')) or {}

    # Initialize calendar
    renderCalendar(currentYear, currentMonth)
    renderWeekView()

    # Event listeners
    def prev_month(event):
        nonlocal currentMonth, currentYear
        currentMonth -= 1
        if currentMonth < 0:
            currentMonth = 11
            currentYear -= 1
        renderCalendar(currentYear, currentMonth)
    
    def next_month(event):
        nonlocal currentMonth, currentYear
        currentMonth += 1
        if currentMonth > 11:
            currentMonth = 0
            currentYear += 1
        renderCalendar(currentYear, currentMonth)
    
    def cancel_meal(event):
        mealFormEl.style.display = 'none'
    
    def meal_type_change(event):
        updateMealOptions(mealTypeEl.value)
    
    def save_meal(event):
        if not selectedDate:
            return
        
        mealType = mealTypeEl.value
        mealName = mealNameEl.value
        
        if not mealName:
            return
        
        dateKey = formatDateKey(selectedDate)
        
        if not plannedMeals.get(dateKey):
            plannedMeals[dateKey] = []
        
        # Check if this meal type already exists for this date
        existingIndex = -1
        for i, meal in enumerate(plannedMeals[dateKey]):
            if meal['type'] == mealType:
                existingIndex = i
                break
        
        if existingIndex >= 0:
            # Replace existing meal of this type
            plannedMeals[dateKey][existingIndex] = {
                'type': mealType,
                'name': mealName
            }
        else:
            # Add new meal
            plannedMeals[dateKey].append({
                'type': mealType,
                'name': mealName
            })
        
        localStorage.setItem('plannedMeals', JSON.stringify(plannedMeals))
        renderCalendar(currentYear, currentMonth)
        renderWeekView()
        mealFormEl.style.display = 'none'

    prevMonthBtn.addEventListener('click', create_proxy(prev_month))
    nextMonthBtn.addEventListener('click', create_proxy(next_month))
    cancelMealBtn.addEventListener('click', create_proxy(cancel_meal))
    mealTypeEl.addEventListener('change', create_proxy(meal_type_change))
    saveMealBtn.addEventListener('click', create_proxy(save_meal))

    # Update meal options based on selected type
    def updateMealOptions(mealType):
        mealNameEl.innerHTML = ''
        
        # Add default option
        defaultOption = document.createElement('option')
        defaultOption.value = ''
        defaultOption.textContent = '-- Select a meal --'
        mealNameEl.appendChild(defaultOption)
        
        # Add saved meals for this type
        if savedMeals.get(mealType) and len(savedMeals[mealType]) > 0:
            for meal in savedMeals[mealType]:
                option = document.createElement('option')
                option.value = meal['name']
                option.textContent = meal['name']
                mealNameEl.appendChild(option)
        else:
            noMealsOption = document.createElement('option')
            noMealsOption.value = ''
            noMealsOption.textContent = 'No saved meals for this type'
            mealNameEl.appendChild(noMealsOption)

    # Render calendar function
    def renderCalendar(year, month):
        # Update month header
        monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"]
        currentMonthEl.textContent = f"{monthNames[month]} {year}"
        
        # Get first and last day of month
        firstDay = Date.new(year, month, 1)
        lastDay = Date.new(year, month + 1, 0)
        
        # Get days in month
        daysInMonth = lastDay.getDate()
        
        # Get starting day of week (0-6)
        startDay = firstDay.getDay()
        
        # Clear calendar
        calendarEl.innerHTML = ''
        
        # Add day headers
        dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
        for day in dayNames:
            dayHeader = document.createElement('div')
            dayHeader.className = 'day-header'
            dayHeader.textContent = day
            calendarEl.appendChild(dayHeader)
        
        # Add empty cells for days before the first day of month
        for i in range(startDay):
            emptyDay = document.createElement('div')
            emptyDay.className = 'day empty'
            calendarEl.appendChild(emptyDay)
        
        # Add days of month
        for day in range(1, daysInMonth + 1):
            date = Date.new(year, month, day)
            dateKey = formatDateKey(date)
            dayEl = document.createElement('div')
            dayEl.className = 'day'
            
            # Add day number
            dayNumber = document.createElement('div')
            dayNumber.className = 'day-number'
            dayNumber.textContent = day
            dayEl.appendChild(dayNumber)
            
            # Add meals if any
            if plannedMeals.get(dateKey) and len(plannedMeals[dateKey]) > 0:
                for meal in plannedMeals[dateKey]:
                    mealEl = document.createElement('div')
                    mealEl.className = f"meal-item {meal['type']}"
                    mealEl.innerHTML = f"""
                        {meal['name']}
                        <span class="remove-meal" data-date="{dateKey}" data-type="{meal['type']}">✕</span>
                    """
                    dayEl.appendChild(mealEl)
            
            # Add click event
            def day_click_handler(e, date=date, month=month, day=day, year=year):
                # Don't open form if clicking on remove button
                if e.target.classList.contains('remove-meal'):
                    return
                
                nonlocal selectedDate
                selectedDate = date
                selectedDateEl.textContent = f"{monthNames[month]} {day}, {year}"
                mealFormEl.style.display = 'block'
                
                # Set default meal type and update options
                mealTypeEl.value = 'breakfast'
                updateMealOptions('breakfast')
            
            dayEl.addEventListener('click', create_proxy(day_click_handler))
            
            # Highlight current day
            today = Date.new()
            if (date.getDate() == today.getDate() and 
                date.getMonth() == today.getMonth() and 
                date.getFullYear() == today.getFullYear()):
                dayEl.style.border = '2px solid #4CAF50'
            
            calendarEl.appendChild(dayEl)
        
        # Add event listeners to remove buttons
        for btn in document.querySelectorAll('.remove-meal'):
            def remove_handler(e, btn=btn):
                dateKey = btn.getAttribute('data-date')
                mealType = btn.getAttribute('data-type')
                
                if plannedMeals.get(dateKey):
                    plannedMeals[dateKey] = [meal for meal in plannedMeals[dateKey] if meal['type'] != mealType]
                    
                    if len(plannedMeals[dateKey]) == 0:
                        del plannedMeals[dateKey]
                    
                    localStorage.setItem('plannedMeals', JSON.stringify(plannedMeals))
                    renderCalendar(year, month)
                    renderWeekView()
            
            btn.addEventListener('click', create_proxy(remove_handler))
    
    # Render week view
    def renderWeekView():
        weekViewEl.innerHTML = ''
        
        today = Date.new()
        currentDay = today.getDay() # 0 (Sun) to 6 (Sat)
        startOfWeek = Date.new(today)
        startOfWeek.setDate(today.getDate() - currentDay)
        
        for i in range(7):
            day = Date.new(startOfWeek)
            day.setDate(startOfWeek.getDate() + i)
            dateKey = formatDateKey(day)
            
            dayEl = document.createElement('div')
            dayEl.className = 'week-day'
            
            dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
            dayName = dayNames[i]
            dayNumber = day.getDate()
            monthNamesShort = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
            monthName = monthNamesShort[day.getMonth()]
            
            dayEl.innerHTML = f"<h4>{dayName}<br>{monthName} {dayNumber}</h4>"
            
            if plannedMeals.get(dateKey) and len(plannedMeals[dateKey]) > 0:
                for meal in plannedMeals[dateKey]:
                    mealEl = document.createElement('div')
                    mealEl.className = f"meal-item {meal['type']}"
                    mealTypeCapitalized = meal['type'][0].upper() + meal['type'][1:]
                    mealEl.innerHTML = f"""
                        <strong>{mealTypeCapitalized}:</strong> {meal['name']}
                        <span class="remove-meal" data-date="{dateKey}" data-type="{meal['type']}">✕</span>
                    """
                    dayEl.appendChild(mealEl)
            else:
                emptyEl = document.createElement('div')
                emptyEl.className = 'empty-day'
                emptyEl.textContent = 'No meals planned'
                dayEl.appendChild(emptyEl)
            
            weekViewEl.appendChild(dayEl)
    
    # Helper function to format date as key
    def formatDateKey(date):
        return f"{date.getFullYear()}-{date.getMonth()}-{date.getDate()}"

    # Initialize selectedDate
    selectedDate = None

# Run the app when DOM is loaded
document.addEventListener('DOMContentLoaded', create_proxy(run))
  </py-script>
</body>
</html>
